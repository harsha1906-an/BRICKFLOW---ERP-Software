doctype html
html
  head
    style.
      @page {
        size: A4;
        margin: 15mm;
      }
      body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        color: #333;
        font-size: 12px;
        line-height: 1.5;
      }
      .header {
        margin-bottom: 20px;
        border-bottom: 2px solid #0091ea;
        padding-bottom: 10px;
      }
      .report-title {
        font-size: 24px;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }
      .meta-info {
        font-size: 14px;
        color: #666;
      }
      .section {
        margin-top: 20px;
        margin-bottom: 30px;
      }
      .section-header {
        background-color: #0288d1;
        color: #fff;
        padding: 8px 10px;
        font-weight: 600;
        font-size: 14px;
        border-radius: 4px 4px 0 0;
      }
      .info-table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #e0e0e0;
      }
      .info-table td {
        padding: 8px;
        border-bottom: 1px solid #e0e0e0;
        vertical-align: top;
      }
      .label-cell {
        background-color: #f5f5f5;
        font-weight: bold;
        width: 30%;
        color: #555;
      }
      .value-cell {
        width: 70%;
      }
      .footer-section {
        position: fixed;
        bottom: 0;
        right: 0;
        width: 100%;
        text-align: center;
        font-size: 10px;
        color: #999;
        border-top: 1px solid #eee;
        padding-top: 10px;
      }
      .tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
      }
      .tag-blue { background-color: #e6f7ff; color: #1890ff; border: 1px solid #91d5ff; }
      .tag-green { background-color: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
      .tag-red { background-color: #fff1f0; color: #f5222d; border: 1px solid #ffa39e; }
      .stripe-table {
        width: 100%;
        border-collapse: collapse;
      }
      .stripe-table th {
        background-color: #f0f0f0;
        color: #333;
        font-weight: bold;
        text-align: left;
        padding: 8px;
        border-bottom: 2px solid #ddd;
      }
      .stripe-table td {
        padding: 8px;
        border-bottom: 1px solid #eee;
      }
      .stripe-table tr:nth-child(even) {
        background-color: #f9f9f9;
      }
      .text-right { text-align: right; }
      .text-center { text-align: center; }
      .font-bold { font-weight: bold; }
      .color-green { color: #389e0d; }
      .color-red { color: #cf1322; }

  body
    .header(style="display: flex; justify-content: space-between; align-items: center;")
      div
        if logo
          img(src=logo, style="max-height: 50px; margin-bottom: 10px;")
        .report-title Booking Details
        div(style="font-size: 10px; color: #666; margin-top: 5px")
            div #{settings.company_name}
            if settings.company_address
                div #{settings.company_address}
            div
                if settings.company_phone
                    span Phone: #{settings.company_phone} 
                if settings.company_email
                    span | Email: #{settings.company_email}
      .meta-info(style="text-align: right;")
        div Generated: #{moment().format(dateFormat)}
        div Booking Date: #{moment(model.bookingDate).format(dateFormat)}
        div Booking ID: #{model._id.toString().substr(-6).toUpperCase()}

    .section
       .section-header Customer Information
       table.info-table
         tr
           td.label-cell Customer Name
           td.value-cell #{model.client ? model.client.name : '-'}
         tr
           td.label-cell Customer ID
           td.value-cell #{model.customerId || (model.client && model.client.customerId) || '-'}
         tr
           td.label-cell Phone / Email
           td.value-cell #{model.phone || '-'} / #{model.email || '-'}
         tr
           td.label-cell Address
           td.value-cell #{model.address || '-'}

    .section
       .section-header Villa Details
       table.info-table
         tr
           td.label-cell Villa Number
           td.value-cell #{model.villaNumber || (model.villa && model.villa.villaNumber) || '-'}
         tr
           td.label-cell Type / Facing
           td.value-cell #{model.houseType || '-'} / #{model.facing || '-'}
         tr
           td.label-cell Area Details
           td.value-cell 
             div Land: #{model.landArea} sq.ft
             div Built-up: #{model.builtUpArea} sq.ft

    .section
       .section-header Financial Summary
       table.stripe-table
         thead
           tr
             th Account Type
             th.text-right Total Amount
             th.text-right Paid Amount
             th.text-right Pending Due
         tbody
           tr
             td.font-bold Official (White)
             td.text-right #{moneyFormatter({amount: model.accountableAmount || model.officialAmount})}
             td.text-right.color-green #{moneyFormatter({amount: stats.paidWhite})}
             td.text-right.font-bold(class=stats.pendingWhite > 0 ? "color-red" : "color-green") #{moneyFormatter({amount: stats.pendingWhite})}
           tr
             td.font-bold Internal (Black)
             td.text-right #{moneyFormatter({amount: model.nonAccountableAmount || model.internalAmount})}
             td.text-right.color-green #{moneyFormatter({amount: stats.paidBlack})}
             td.text-right.font-bold(class=stats.pendingBlack > 0 ? "color-red" : "color-green") #{moneyFormatter({amount: stats.pendingBlack})}
           tr(style="background-color: #e6f7ff; border-top: 2px solid #91d5ff;")
             td.font-bold TOTAL
             td.text-right.font-bold #{moneyFormatter({amount: model.totalAmount})}
             td.text-right.font-bold.color-green #{moneyFormatter({amount: stats.totalPaid})}
             td.text-right.font-bold(class=stats.pendingTotal > 0 ? "color-red" : "color-green") #{moneyFormatter({amount: stats.pendingTotal})}

    .section
      .section-header Payment History
      if payments && payments.length > 0
        table.stripe-table
          thead
             tr
               th Date
               th Amount
               th Mode
               th Account
               th Ref #
          tbody
             each p in payments
               tr
                 td #{moment(p.date).format(dateFormat)}
                 td #{moneyFormatter({amount: p.amount})}
                 td #{p.paymentMode}
                 td #{p.ledger === 'internal' ? 'Internal' : 'Official'}
                 td #{p.ref || p.transactionCode || '-'}
      else
        div(style="padding: 10px; color: #666; font-style: italic;") No payments recorded yet.

    if model.paymentPlan && model.paymentPlan.length > 0
      .section
        .section-header Payment Schedule / Milestones
        table.stripe-table
          thead
            tr
              th Milestone
              th Due Date
              th Amount
              th Paid
              th Status
          tbody
            each plan in model.paymentPlan
              tr
                td #{plan.name}
                td #{plan.dueDate ? moment(plan.dueDate).format(dateFormat) : '-'}
                td #{moneyFormatter({amount: plan.amount})}
                td #{moneyFormatter({amount: plan.paidAmount || 0})}
                td
                  if plan.status === 'paid'
                     span.tag.tag-green Paid
                  else if plan.status === 'overdue'
                     span.tag.tag-red Overdue
                  else
                     span.tag.tag-blue #{plan.status}

    .footer-section
      | This document is system generated by #{settings.company_name}.
